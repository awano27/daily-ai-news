<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>オンライン診療の予約・決済システム 要件定義書</title>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
            line-height: 1.8;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-left: 5px solid #3498db;
            padding-left: 10px;
            margin-top: 30px;
        }
        h3 {
            color: #7f8c8d;
            margin-top: 20px;
        }
        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .requirement-id {
            font-weight: bold;
            color: #e74c3c;
        }
        .flow-diagram {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        ul {
            margin: 10px 0;
            padding-left: 30px;
        }
        li {
            margin: 5px 0;
        }
        .api-endpoint {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        .method {
            background: #27ae60;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>オンライン診療の予約・決済システム 要件定義書</h1>
    
    <div class="section">
        <h2>1. 概要</h2>
        <h3>1.1 システム概要</h3>
        <p>本システムは、患者が医師とのオンライン診療を予約し、診療費の決済を行うためのWebベースのプラットフォームです。患者はスマートフォンやPCから診療予約を行い、ビデオ通話による診療を受け、オンラインで決済を完了できます。</p>
        
        <h3>1.2 システムの目的</h3>
        <ul>
            <li>患者の通院負担を軽減し、医療アクセスを向上</li>
            <li>医療機関の診療効率を改善</li>
            <li>感染症リスクの低減</li>
            <li>地域医療格差の解消</li>
        </ul>
        
        <h3>1.3 対象ユーザー</h3>
        <ul>
            <li><strong>患者</strong>：オンライン診療を希望する一般利用者</li>
            <li><strong>医師</strong>：オンライン診療を提供する医療従事者</li>
            <li><strong>医療事務</strong>：予約管理・請求処理を行う事務スタッフ</li>
            <li><strong>システム管理者</strong>：システム全体の管理・運用担当者</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>2. 用語定義</h2>
        <table>
            <thead>
                <tr>
                    <th>用語</th>
                    <th>定義</th>
                    <th>備考</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>オンライン診療</td>
                    <td>ビデオ通話を用いた遠隔での医療診察</td>
                    <td>厚生労働省のガイドラインに準拠</td>
                </tr>
                <tr>
                    <td>診療枠</td>
                    <td>医師が診療可能な時間帯の単位（通常15分または30分）</td>
                    <td>医師ごとに設定可能</td>
                </tr>
                <tr>
                    <td>問診票</td>
                    <td>診療前に患者が記入する症状・既往歴等の情報</td>
                    <td>電子フォーム形式</td>
                </tr>
                <tr>
                    <td>処方箋</td>
                    <td>医師が発行する薬の処方指示書</td>
                    <td>電子処方箋対応</td>
                </tr>
                <tr>
                    <td>保険診療</td>
                    <td>健康保険が適用される診療</td>
                    <td>保険証の事前確認必須</td>
                </tr>
                <tr>
                    <td>自由診療</td>
                    <td>健康保険が適用されない全額自己負担の診療</td>
                    <td>美容診療など</td>
                </tr>
                <tr>
                    <td>決済トークン</td>
                    <td>クレジットカード情報を安全に処理するための一時的な識別子</td>
                    <td>PCI DSS準拠</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="section">
        <h2>3. 業務フロー</h2>
        
        <h3>3.1 予約から診療完了までの基本フロー</h3>
        <div class="flow-diagram">
            <ol>
                <li><strong>会員登録</strong>
                    <ul>
                        <li>患者：基本情報・保険証情報を登録</li>
                        <li>本人確認（SMS認証）</li>
                    </ul>
                </li>
                <li><strong>診療予約</strong>
                    <ul>
                        <li>診療科・医師を選択</li>
                        <li>空き枠から希望日時を選択</li>
                        <li>問診票を入力</li>
                    </ul>
                </li>
                <li><strong>予約確認</strong>
                    <ul>
                        <li>医療機関側で予約を確認・承認</li>
                        <li>患者へ予約確定通知（メール・SMS）</li>
                    </ul>
                </li>
                <li><strong>診療当日</strong>
                    <ul>
                        <li>予約時間前にリマインド通知</li>
                        <li>ビデオ通話による診療実施</li>
                        <li>必要に応じて処方箋発行</li>
                    </ul>
                </li>
                <li><strong>決済処理</strong>
                    <ul>
                        <li>診療費の自動計算</li>
                        <li>クレジットカード決済実行</li>
                        <li>領収書・明細書の発行</li>
                    </ul>
                </li>
                <li><strong>アフターフォロー</strong>
                    <ul>
                        <li>診療記録の保存</li>
                        <li>次回予約の案内</li>
                        <li>満足度アンケート</li>
                    </ul>
                </li>
            </ol>
        </div>
        
        <h3>3.2 キャンセル・変更フロー</h3>
        <ul>
            <li>予約24時間前まで：無料でキャンセル・変更可能</li>
            <li>24時間以内：キャンセル料発生（診療費の50%）</li>
            <li>無断キャンセル：診療費の100%請求</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>4. 機能要件</h2>
        
        <h3>4.1 患者向け機能</h3>
        <table>
            <thead>
                <tr>
                    <th>機能ID</th>
                    <th>機能名</th>
                    <th>説明</th>
                    <th>優先度</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="requirement-id">P-001</td>
                    <td>会員登録</td>
                    <td>メールアドレス、パスワード、基本情報の登録</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-002</td>
                    <td>ログイン/ログアウト</td>
                    <td>メールアドレスとパスワードによる認証</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-003</td>
                    <td>医師検索</td>
                    <td>診療科、曜日、時間帯での検索</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-004</td>
                    <td>診療予約</td>
                    <td>カレンダーから空き枠を選択して予約</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-005</td>
                    <td>問診票入力</td>
                    <td>症状、既往歴、アレルギー情報等の入力</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-006</td>
                    <td>予約確認・変更・キャンセル</td>
                    <td>予約内容の確認と変更、キャンセル処理</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-007</td>
                    <td>ビデオ診療</td>
                    <td>WebRTCによるビデオ通話機能</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-008</td>
                    <td>決済機能</td>
                    <td>クレジットカード決済（Stripe/PAY.JP連携）</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-009</td>
                    <td>診療履歴閲覧</td>
                    <td>過去の診療記録、処方箋の確認</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">P-010</td>
                    <td>通知受信</td>
                    <td>予約確認、リマインダー、診療開始通知</td>
                    <td>必須</td>
                </tr>
            </tbody>
        </table>
        
        <h3>4.2 医師向け機能</h3>
        <table>
            <thead>
                <tr>
                    <th>機能ID</th>
                    <th>機能名</th>
                    <th>説明</th>
                    <th>優先度</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="requirement-id">D-001</td>
                    <td>診療スケジュール管理</td>
                    <td>診療可能時間の設定、休診日の登録</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">D-002</td>
                    <td>予約確認・承認</td>
                    <td>患者からの予約を確認し承認/却下</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">D-003</td>
                    <td>患者情報閲覧</td>
                    <td>患者の基本情報、問診票、診療履歴の確認</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">D-004</td>
                    <td>ビデオ診療実施</td>
                    <td>ビデオ通話、画面共有、チャット機能</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">D-005</td>
                    <td>カルテ記載</td>
                    <td>診療内容の記録、SOAP形式対応</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">D-006</td>
                    <td>処方箋発行</td>
                    <td>電子処方箋の作成・送信</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">D-007</td>
                    <td>診療報酬管理</td>
                    <td>診療費の設定、保険点数の計算</td>
                    <td>必須</td>
                </tr>
            </tbody>
        </table>
        
        <h3>4.3 管理者向け機能</h3>
        <table>
            <thead>
                <tr>
                    <th>機能ID</th>
                    <th>機能名</th>
                    <th>説明</th>
                    <th>優先度</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="requirement-id">A-001</td>
                    <td>ユーザー管理</td>
                    <td>患者・医師・スタッフのアカウント管理</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">A-002</td>
                    <td>医療機関管理</td>
                    <td>提携医療機関の登録・編集・削除</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">A-003</td>
                    <td>決済管理</td>
                    <td>売上管理、返金処理、請求書発行</td>
                    <td>必須</td>
                </tr>
                <tr>
                    <td class="requirement-id">A-004</td>
                    <td>統計・レポート</td>
                    <td>利用状況、売上分析、医師別実績</td>
                    <td>高</td>
                </tr>
                <tr>
                    <td class="requirement-id">A-005</td>
                    <td>システム設定</td>
                    <td>料金設定、通知テンプレート、利用規約管理</td>
                    <td>必須</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="section">
        <h2>5. 非機能要件</h2>
        
        <h3>5.1 性能要件</h3>
        <table>
            <thead>
                <tr>
                    <th>項目</th>
                    <th>要件</th>
                    <th>測定条件</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>レスポンスタイム</td>
                    <td>画面遷移：3秒以内、API応答：1秒以内</td>
                    <td>通常負荷時</td>
                </tr>
                <tr>
                    <td>同時接続数</td>
                    <td>1,000ユーザー以上</td>
                    <td>ピーク時間帯</td>
                </tr>
                <tr>
                    <td>ビデオ通話品質</td>
                    <td>HD画質（720p）、遅延100ms以下</td>
                    <td>推奨帯域幅：3Mbps以上</td>
                </tr>
                <tr>
                    <td>データ処理能力</td>
                    <td>1時間あたり500件の予約処理</td>
                    <td>バッチ処理時</td>
                </tr>
            </tbody>
        </table>
        
        <h3>5.2 セキュリティ要件</h3>
        <ul>
            <li><strong>認証・認可</strong>
                <ul>
                    <li>多要素認証（MFA）対応</li>
                    <li>JWTトークンによるセッション管理</li>
                    <li>ロールベースアクセス制御（RBAC）</li>
                </ul>
            </li>
            <li><strong>データ保護</strong>
                <ul>
                    <li>通信：TLS 1.3による暗号化</li>
                    <li>保存データ：AES-256による暗号化</li>
                    <li>個人情報のマスキング処理</li>
                </ul>
            </li>
            <li><strong>コンプライアンス</strong>
                <ul>
                    <li>医療情報システムの安全管理ガイドライン準拠</li>
                    <li>個人情報保護法対応</li>
                    <li>PCI DSS準拠（決済情報）</li>
                </ul>
            </li>
        </ul>
        
        <h3>5.3 可用性要件</h3>
        <table>
            <thead>
                <tr>
                    <th>項目</th>
                    <th>要件</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>稼働率</td>
                    <td>99.9%以上（年間ダウンタイム：8.76時間以内）</td>
                </tr>
                <tr>
                    <td>計画停止</td>
                    <td>月1回、深夜2時間以内</td>
                </tr>
                <tr>
                    <td>障害復旧時間（RTO）</td>
                    <td>4時間以内</td>
                </tr>
                <tr>
                    <td>データ復旧時点（RPO）</td>
                    <td>1時間以内</td>
                </tr>
                <tr>
                    <td>バックアップ</td>
                    <td>日次フルバックアップ、1時間ごとの差分バックアップ</td>
                </tr>
            </tbody>
        </table>
        
        <h3>5.4 保守性要件</h3>
        <ul>
            <li>モジュール化されたアーキテクチャ</li>
            <li>詳細なログ出力とモニタリング</li>
            <li>自動テストカバレッジ80%以上</li>
            <li>CI/CDパイプラインの構築</li>
            <li>ドキュメントの整備（設計書、運用手順書）</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>6. API仕様</h2>
        
        <h3>6.1 認証API</h3>
        <div class="api-endpoint">
            <span class="method">POST</span> /api/v1/auth/login
        </div>
        <p>ユーザーログイン</p>
        <pre>
Request:
{
  "email": "user@example.com",
  "password": "password123"
}

Response:
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "user": {
    "id": "12345",
    "name": "山田太郎",
    "role": "patient"
  }
}
        </pre>
        
        <h3>6.2 予約API</h3>
        <div class="api-endpoint">
            <span class="method">GET</span> /api/v1/appointments/slots
        </div>
        <p>利用可能な診療枠の取得</p>
        <pre>
Request Parameters:
- doctor_id: 医師ID
- date_from: 開始日（YYYY-MM-DD）
- date_to: 終了日（YYYY-MM-DD）

Response:
{
  "slots": [
    {
      "id": "slot_001",
      "doctor_id": "doc_123",
      "datetime": "2024-01-15T10:00:00+09:00",
      "duration_minutes": 30,
      "available": true
    }
  ]
}
        </pre>
        
        <div class="api-endpoint">
            <span class="method">POST</span> /api/v1/appointments
        </div>
        <p>診療予約の作成</p>
        <pre>
Request:
{
  "slot_id": "slot_001",
  "patient_id": "patient_456",
  "symptoms": "頭痛、発熱",
  "questionnaire": {
    "allergies": "なし",
    "medications": "なし",
    "medical_history": "高血圧"
  }
}

Response:
{
  "appointment_id": "apt_789",
  "status": "confirmed",
  "datetime": "2024-01-15T10:00:00+09:00",
  "meeting_url": "https://meet.example.com/room/abc123"
}
        </pre>
        
        <h3>6.3 決済API</h3>
        <div class="api-endpoint">
            <span class="method">POST</span> /api/v1/payments
        </div>
        <p>決済処理</p>
        <pre>
Request:
{
  "appointment_id": "apt_789",
  "payment_method": "credit_card",
  "token": "tok_visa_4242",
  "amount": 3000,
  "currency": "JPY"
}

Response:
{
  "payment_id": "pay_xyz",
  "status": "succeeded",
  "amount": 3000,
  "receipt_url": "https://receipts.example.com/pay_xyz"
}
        </pre>
        
        <h3>6.4 通知API</h3>
        <div class="api-endpoint">
            <span class="method">POST</span> /api/v1/notifications/send
        </div>
        <p>通知送信</p>
        <pre>
Request:
{
  "recipient_id": "patient_456",
  "type": "appointment_reminder",
  "channels": ["email", "sms"],
  "data": {
    "appointment_id": "apt_789",
    "datetime": "2024-01-15T10:00:00+09:00"
  }
}

Response:
{
  "notification_id": "notif_123",
  "status": "sent",
  "sent_at": "2024-01-14T18:00:00+09:00"
}
        </pre>
    </div>
    
    <div class="section">
        <h2>7. テスト観点</h2>
        
        <h3>7.1 機能テスト</h3>
        <table>
            <thead>
                <tr>
                    <th>テスト分類</th>
                    <th>テスト項目</th>
                    <th>確認内容</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ユーザー認証</td>
                    <td>ログイン機能</td>
                    <td>
                        <ul>
                            <li>正しい認証情報でログイン成功</li>
                            <li>誤った認証情報でエラー表示</li>
                            <li>アカウントロック機能の動作</li>
                            <li>パスワードリセット機能</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>予約機能</td>
                    <td>診療予約フロー</td>
                    <td>
                        <ul>
                            <li>空き枠の正確な表示</li>
                            <li>重複予約の防止</li>
                            <li>予約確認メールの送信</li>
                            <li>キャンセル処理の正常動作</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>ビデオ通話</td>
                    <td>診療実施機能</td>
                    <td>
                        <ul>
                            <li>ビデオ・音声の接続確立</li>
                            <li>通話品質の確認</li>
                            <li>画面共有機能</li>
                            <li>接続切断時の再接続処理</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>決済処理</td>
                    <td>支払い機能</td>
                    <td>
                        <ul>
                            <li>金額計算の正確性</li>
                            <li>決済成功・失敗の処理</li>
                            <li>領収書の発行</li>
                            <li>返金処理の動作</li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <h3>7.2 非機能テスト</h3>
        <table>
            <thead>
                <tr>
                    <th>テスト種別</th>
                    <th>テスト内容</th>
                    <th>合格基準</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>性能テスト</td>
                    <td>
                        <ul>
                            <li>負荷テスト（1000ユーザー同時アクセス）</li>
                            <li>レスポンスタイム測定</li>
                            <li>ビデオ通話の遅延測定</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>エラー率1%未満</li>
                            <li>平均レスポンス3秒以内</li>
                            <li>遅延100ms以下</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>セキュリティテスト</td>
                    <td>
                        <ul>
                            <li>SQLインジェクション対策</li>
                            <li>XSS対策</li>
                            <li>認証・認可の確認</li>
                            <li>データ暗号化の確認</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>脆弱性検出0件</li>
                            <li>OWASP Top10対応</li>
                            <li>ペネトレーションテスト合格</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>互換性テスト</td>
                    <td>
                        <ul>
                            <li>ブラウザ互換性（Chrome, Safari, Edge, Firefox）</li>
                            <li>デバイス互換性（PC, タブレット, スマートフォン）</li>
                            <li>OS互換性（Windows, macOS, iOS, Android）</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>主要ブラウザで正常動作</li>
                            <li>レスポンシブデザイン対応</li>
                            <li>各OSで機能制限なし</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>ユーザビリティテスト</td>
                    <td>
                        <ul>
                            <li>操作性の確認</li>
                            <li>エラーメッセージの適切性</li>
                            <li>アクセシビリティ対応</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>タスク完了率90%以上</li>
                            <li>満足度スコア4.0以上/5.0</li>
                            <li>WCAG 2.1 Level AA準拠</li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <h3>7.3 受け入れテスト</h3>
        <ul>
            <li><strong>シナリオテスト</strong>
                <ul>
                    <li>新規患者の登録から診療完了まで</li>
                    <li>リピート患者の予約フロー</li>
                    <li>緊急キャンセル対応</li>
                    <li>システム障害時の復旧手順</li>
                </ul>
            </li>
            <li><strong>運用テスト</strong>
                <ul>
                    <li>バックアップ・リストア</li>
                    <li>ログ監視・アラート通知</li>
                    <li>定期メンテナンス手順</li>
                </ul>
            </li>
        </ul>
    </div>
    
    <div class="section">
        <h2>8. 制約事項</h2>
        <ul>
            <li>初診は対面診療が原則（厚生労働省ガイドライン）</li>
            <li>処方可能な薬剤に制限あり（向精神薬等は不可）</li>
            <li>診療記録は5年間の保存義務</li>
            <li>18歳未満の患者は保護者の同意が必要</li>
            <li>海外からのアクセスは不可（国内限定）</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>9. 今後の拡張予定</h2>
        <ul>
            <li>AI問診機能の追加</li>
            <li>薬局連携による処方薬配送</li>
            <li>ウェアラブルデバイス連携</li>
            <li>多言語対応（英語、中国語）</li>
            <li>グループ診療機能</li>
            <li>保険請求の自動化</li>
        </ul>
    </div>
    
    <div class="section" style="margin-top: 40px; text-align: center; color: #7f8c8d;">
        <p>文書作成日：2024年1月</p>
        <p>バージョン：1.0</p>
    </div>
</body>
</html>