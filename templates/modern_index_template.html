<!doctype html>
<html lang="ja" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>%%PAGE_TITLE%%</title>
  <meta name="description" content="Daily AI News は AI 動向を俯瞰できる日本語ダイジェストです。最終更新：%%UPDATED_FULL%%、対象期間：過去 %%LOOKBACK_HOURS%% 時間。"/>
  <meta name="color-scheme" content="light dark"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Manrope:wght@600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style-modern.css"/>
  <!-- Last update: %%GENERATED_AT%% -->
</head>
<body>
  <a class="skip-link" href="#mainContent">本文へスキップ</a>

  <header class="site-header" id="top" role="banner">
    <div class="header-inner">
      <div class="brand-area" aria-label="Daily AI News">
        <span class="brand-logo" aria-hidden="true">📰</span>
        <div class="brand-copy">
          <span class="brand-name">Daily AI News</span>
          <span class="brand-tagline">AIの最前線を日本語でスピーディに把握</span>
        </div>
      </div>

      <nav class="site-nav" aria-label="主要ナビゲーション">
        <ul class="site-nav__list">
          <li><a href="#insights">指標</a></li>
          <li><a href="#filters">検索</a></li>
          <li><a href="#newsResults">最新記事</a></li>
          <li><a href="#aboutSection">サイトについて</a></li>
          <li><a href="#contactSection">お問い合わせ</a></li>
        </ul>
      </nav>

      <button id="themeToggle" class="theme-toggle" type="button" aria-pressed="false" aria-label="テーマを切り替え">
        <span class="theme-toggle__icon" aria-hidden="true">🌞</span>
        <span class="theme-toggle__label">ライト</span>
      </button>
    </div>
  </header>

  <main id="mainContent" class="page-content">
    <section class="hero" aria-labelledby="heroTitle">
      <h1 id="heroTitle">今日の最新AI情報</h1>
      <p class="lead">
        世界の生成AI・機械学習に関する公式発表、資金調達、研究論文、開発者コミュニティの投稿を横断的に収集。
        重要度と鮮度で優先順位付けし、日本語サマリーと原文リンクをセットでお届けします。
      </p>
      <dl class="hero-meta">
        <div>
          <dt>最終更新</dt>
          <dd>%%UPDATED_FULL%%</dd>
        </div>
        <div>
          <dt>対象期間</dt>
          <dd>過去 %%LOOKBACK_HOURS%% 時間</dd>
        </div>
      </dl>
    </section>

    <section id="insights" class="status-overview" aria-labelledby="insightTitle">
      <div class="section-header">
        <h2 id="insightTitle">主要指標</h2>
        <p class="section-note">記事件数・注目度・情報源など、ダッシュボード全体のスナップショットです。</p>
      </div>
      <div class="metrics-grid" role="list">
        <article class="metric-card" role="listitem">
          <span class="metric-card__value">%%TOTAL_ITEMS%%件</span>
          <span class="metric-card__label">掲載記事数</span>
          <span class="metric-card__note">全カテゴリ合計</span>
        </article>
        <article class="metric-card" role="listitem">
          <span class="metric-card__value">%%HIGH_PRIORITY_ITEMS%%件</span>
          <span class="metric-card__label">重要度 高</span>
          <span class="metric-card__note">スコア 7.0 以上</span>
        </article>
        <article class="metric-card" role="listitem">
          <span class="metric-card__value">%%SOURCE_COUNT%%件</span>
          <span class="metric-card__label">情報源</span>
          <span class="metric-card__note">多角的なソース</span>
        </article>
        <article class="metric-card" role="listitem">
          <span class="metric-card__value">%%LOOKBACK_LABEL%%</span>
          <span class="metric-card__label">収集範囲</span>
          <span class="metric-card__note">最新性を重視</span>
        </article>
      </div>
      <ul class="metric-summary">
        <li>ビジネス：%%BUSINESS_COUNT%%件</li>
        <li>ツール：%%TOOLS_COUNT%%件</li>
        <li>SNS / 論文：%%POSTS_COUNT%%件</li>
      </ul>
    </section>

    <section id="filters" class="filter-panel" aria-labelledby="filterTitle">
      <div class="section-header">
        <h2 id="filterTitle">検索とフィルタ</h2>
        <p class="section-note">キーワードと複数フィルタを組み合わせて、目的の記事を素早く見つけましょう。</p>
      </div>
      <form class="filters-form" role="search">
        <div class="filter-field filter-field--search">
          <label class="filter-label" for="searchInput">キーワード検索</label>
          <input type="search" id="searchInput" class="filter-input" autocomplete="off" placeholder="例：LLM、OpenAI、Gemini、論文など" aria-describedby="searchHelp"/>
          <p id="searchHelp" class="filter-help">Enter キーでキーワードを追加できます。</p>
          <div id="searchTags" class="search-tags" aria-live="polite" role="list"></div>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="importanceFilter">重要度</label>
          <select id="importanceFilter" class="filter-select" title="記事の重要度を基準に絞り込みます">
            <option value="all">すべて</option>
            <option value="high">高 (7.0+)</option>
            <option value="medium">中 (4.0-6.9)</option>
            <option value="low">低 (0-3.9)</option>
          </select>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="freshnessFilter">鮮度</label>
          <select id="freshnessFilter" class="filter-select" title="掲載からの経過時間で絞り込みます">
            <option value="all">すべての期間</option>
            <option value="24h">24時間以内</option>
            <option value="72h">3日以内</option>
            <option value="168h">7日以内</option>
          </select>
        </div>

        <div class="filter-field">
          <label class="filter-label" for="sortBy">並び順</label>
          <select id="sortBy" class="filter-select" title="表示順序を変更します">
            <option value="importance">重要度順</option>
            <option value="freshness">鮮度順</option>
            <option value="time">公開が新しい順</option>
            <option value="source">情報源順</option>
            <option value="original">元の順序</option>
          </select>
        </div>

        <div class="filter-actions">
          <button type="button" id="clearFilters" class="button button--secondary" disabled>フィルタをリセット</button>
        </div>
      </form>

      <div class="category-switch" role="group" aria-label="カテゴリを選択">
        <button type="button" class="category-switch__button is-active" data-category="all" aria-pressed="true">すべて</button>
        <button type="button" class="category-switch__button" data-category="business" aria-pressed="false">ビジネス</button>
        <button type="button" class="category-switch__button" data-category="tools" aria-pressed="false">ツール</button>
        <button type="button" class="category-switch__button" data-category="posts" aria-pressed="false">SNS / 論文</button>
      </div>

      <p id="resultsCount" class="results-summary" role="status" aria-live="polite">
        すべて：%%RESULT_COUNT%%件表示（全%%RESULT_COUNT%%件）
      </p>
    </section>

    <section id="newsResults" class="news-results" aria-labelledby="newsResultsTitle">
      <div class="section-header">
        <h2 id="newsResultsTitle">最新記事</h2>
        <p class="section-note">カード内には翻訳済み要約、原文リンク、信頼度、更新時刻を記載しています。</p>
      </div>
      <div id="newsGrid" class="news-grid" role="list" aria-live="polite">
%%LEGACY_SECTIONS%%
      </div>
    </section>

    <section id="sourceHighlights" class="source-insights" aria-labelledby="sourceHeading">
      <div class="section-header">
        <h2 id="sourceHeading">主要ソースの内訳</h2>
        <p class="section-note">関連記事数が多い情報源をランキング形式で表示します。信頼度や投稿シェアも参考にしてください。</p>
      </div>
%%SOURCE_LIST%%
    </section>

    <aside class="additional-info">
      <section id="aboutSection" class="info-section" aria-labelledby="aboutHeading">
        <h2 id="aboutHeading">サイトについて</h2>
        <p>
          Daily AI News は、エンジニア・研究者・ビジネスリーダーが最新情報を効率良くチェックできるように設計した非公式ダッシュボードです。
          重要度スコア、鮮度指標、ソース信頼度を組み合わせ、注目トピックを優先的に表示します。
        </p>
        <p class="info-highlight">
          収集した主な情報源（抜粋）：%%SOURCE_SAMPLE%%
        </p>
      </section>

      <section id="contactSection" class="info-section" aria-labelledby="contactHeading">
        <h2 id="contactHeading">お問い合わせ</h2>
        <p>改善要望やフィード追加のご相談は、<a href="mailto:awano27@gmail.com">awano27@gmail.com</a> までご連絡ください。</p>
        <p>GitHub Pages を利用し、テーマ切り替え・キーボード操作・スクリーンリーダーに配慮したアクセシブルな構成を目指しています。</p>
      </section>
    </aside>
  </main>

  <footer class="site-footer">
    <small>© 2025 Daily AI News. 情報は自動収集のため正確性を保証するものではありません。</small>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const root = document.documentElement;
      const themeToggle = document.getElementById('themeToggle');
      const searchForm = document.querySelector('.filters-form');
      const searchInput = document.getElementById('searchInput');
      const searchTagsContainer = document.getElementById('searchTags');
      const categoryButtons = Array.from(document.querySelectorAll('.category-switch__button'));
      const importanceSelect = document.getElementById('importanceFilter');
      const freshnessSelect = document.getElementById('freshnessFilter');
      const sortSelect = document.getElementById('sortBy');
      const clearButton = document.getElementById('clearFilters');
      const resultsRegion = document.getElementById('resultsCount');
      const newsGrid = document.getElementById('newsGrid');

      const cards = Array.from(newsGrid.querySelectorAll('.news-card'));
      const labelByCategory = new Map([
        ['all', 'すべて'],
        ['business', 'ビジネス'],
        ['tools', 'ツール'],
        ['posts', 'SNS / 論文']
      ]);

      const records = cards.map((card, index) => {
        const textContent = (card.textContent || '').toLowerCase();
        const tags = (card.dataset.tags || '')
          .split(',')
          .map(tag => tag.trim())
          .filter(Boolean);

        return {
          element: card,
          baseIndex: index,
          category: (card.dataset.category || 'all'),
          importance: (card.dataset.importance || 'medium'),
          score: Number(card.dataset.score || '0'),
          freshness: Number(card.dataset.freshness || '0'),
          freshnessBucket: (card.dataset.freshnessBucket || 'all'),
          published: Number(card.dataset.publishedMs || '0'),
          source: (card.dataset.source || '').toLowerCase(),
          tags,
          text: `${textContent} ${tags.join(' ').toLowerCase()}`
        };
      });

      const state = {
        category: 'all',
        importance: 'all',
        freshness: 'all',
        sort: 'importance',
        keywords: [],
        currentInput: ''
      };

      const applyTheme = (theme) => {
        const next = theme === 'dark' ? 'dark' : 'light';
        root.dataset.theme = next;
        const isDark = next === 'dark';
        themeToggle.setAttribute('aria-pressed', String(isDark));
        const icon = themeToggle.querySelector('.theme-toggle__icon');
        const label = themeToggle.querySelector('.theme-toggle__label');
        if (icon) icon.textContent = isDark ? '🌙' : '🌞';
        if (label) label.textContent = isDark ? 'ダーク' : 'ライト';
      };

      const storageKey = 'daily-ai-news-theme';
      try {
        const storedTheme = localStorage.getItem(storageKey);
        if (storedTheme) {
          applyTheme(storedTheme);
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          applyTheme('dark');
        } else {
          applyTheme('light');
        }
      } catch (error) {
        applyTheme('light');
      }

      themeToggle.addEventListener('click', () => {
        const nextTheme = root.dataset.theme === 'dark' ? 'light' : 'dark';
        applyTheme(nextTheme);
        try {
          localStorage.setItem(storageKey, nextTheme);
        } catch (error) {
          /* ignore */
        }
      });

      const renderCategoryButtons = () => {
        categoryButtons.forEach((button) => {
          const isActive = button.dataset.category === state.category;
          button.classList.toggle('is-active', isActive);
          button.setAttribute('aria-pressed', String(isActive));
        });
      };

      const renderTags = () => {
        searchTagsContainer.textContent = '';
        if (state.keywords.length === 0) {
          const placeholder = document.createElement('span');
          placeholder.className = 'search-tags__placeholder';
          placeholder.setAttribute('role', 'listitem');
          placeholder.textContent = 'キーワードを追加するとタグとして表示されます';
          searchTagsContainer.appendChild(placeholder);
          return;
        }

        state.keywords.forEach((keyword, index) => {
          const tag = document.createElement('span');
          tag.className = 'search-tag';
          tag.setAttribute('role', 'listitem');
          tag.textContent = keyword;

          const removeButton = document.createElement('button');
          removeButton.type = 'button';
          removeButton.className = 'search-tag__remove';
          removeButton.setAttribute('aria-label', `検索タグ「${keyword}」を削除`);
          removeButton.innerHTML = '<span aria-hidden="true">×</span>';
          removeButton.addEventListener('click', () => {
            state.keywords.splice(index, 1);
            renderTags();
            applySortAndFilter(false);
          });

          tag.appendChild(removeButton);
          searchTagsContainer.appendChild(tag);
        });
      };

      const sortRecords = () => {
        const sorted = [...records];
        switch (state.sort) {
          case 'freshness':
            sorted.sort((a, b) => b.freshness - a.freshness || b.published - a.published || a.baseIndex - b.baseIndex);
            break;
          case 'time':
            sorted.sort((a, b) => b.published - a.published || b.score - a.score || a.baseIndex - b.baseIndex);
            break;
          case 'source':
            sorted.sort((a, b) => a.source.localeCompare(b.source) || a.baseIndex - b.baseIndex);
            break;
          case 'original':
            sorted.sort((a, b) => a.baseIndex - b.baseIndex);
            break;
          case 'importance':
          default:
            sorted.sort((a, b) => b.score - a.score || b.freshness - a.freshness || a.baseIndex - b.baseIndex);
            break;
        }
        sorted.forEach((record) => newsGrid.appendChild(record.element));
      };

      const applyFilters = () => {
        const keywordsLower = state.keywords.map(keyword => keyword.toLowerCase());
        const extraKeywords = state.currentInput
          ? state.currentInput.split(/\s+/).map(word => word.trim()).filter(Boolean)
          : [];
        const allKeywords = keywordsLower.concat(extraKeywords.map(word => word.toLowerCase()));

        let visibleCount = 0;
        let totalInCategory = 0;

        records.forEach((record) => {
          const matchesCategory = state.category === 'all' || record.category === state.category;
          if (matchesCategory) {
            totalInCategory += 1;
          }

          let visible = matchesCategory;

          if (visible && state.importance !== 'all') {
            visible = record.importance === state.importance;
          }

          if (visible && state.freshness !== 'all') {
            visible = record.freshnessBucket === state.freshness;
          }

          if (visible && allKeywords.length) {
            visible = allKeywords.every((keyword) => {
              if (!keyword) return true;
              return record.text.includes(keyword);
            });
          }

          record.element.hidden = !visible;
          record.element.classList.toggle('is-hidden', !visible);
          record.element.setAttribute('aria-hidden', String(!visible));

          if (visible) {
            visibleCount += 1;
          }
        });

        const label = labelByCategory.get(state.category) || 'すべて';
        resultsRegion.textContent = `${label}：${visibleCount}件表示（全${totalInCategory}件）`;
        clearButton.disabled = (
          state.category === 'all' &&
          state.importance === 'all' &&
          state.freshness === 'all' &&
          state.sort === 'importance' &&
          state.keywords.length === 0 &&
          !state.currentInput
        );
      };

      const applySortAndFilter = (shouldSort = true) => {
        if (shouldSort) {
          sortRecords();
        }
        applyFilters();
      };

      const addKeyword = (value) => {
        const trimmed = value.trim();
        if (!trimmed) return;
        const normalized = trimmed.toLowerCase();
        const duplicated = state.keywords.some((keyword) => keyword.toLowerCase() === normalized);
        if (!duplicated) {
          state.keywords.push(trimmed);
          renderTags();
          applySortAndFilter(false);
        }
      };

      categoryButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const category = button.dataset.category || 'all';
          if (state.category !== category) {
            state.category = category;
            renderCategoryButtons();
            applySortAndFilter(false);
          }
        });

        button.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            button.click();
          }
        });
      });

      importanceSelect.addEventListener('change', () => {
        state.importance = importanceSelect.value;
        applySortAndFilter(false);
      });

      freshnessSelect.addEventListener('change', () => {
        state.freshness = freshnessSelect.value;
        applySortAndFilter(false);
      });

      sortSelect.addEventListener('change', () => {
        state.sort = sortSelect.value || 'importance';
        applySortAndFilter(true);
      });

      searchForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const value = searchInput.value;
        addKeyword(value);
        searchInput.value = '';
        state.currentInput = '';
        applySortAndFilter(false);
      });

      searchInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          event.preventDefault();
          addKeyword(searchInput.value);
          searchInput.value = '';
          state.currentInput = '';
          applySortAndFilter(false);
        }
      });

      searchInput.addEventListener('input', () => {
        state.currentInput = searchInput.value.trim().toLowerCase();
        applySortAndFilter(false);
      });

      clearButton.addEventListener('click', () => {
        state.category = 'all';
        state.importance = 'all';
        state.freshness = 'all';
        state.sort = 'importance';
        state.keywords = [];
        state.currentInput = '';

        categoryButtons[0].focus();
        renderCategoryButtons();

        importanceSelect.value = 'all';
        freshnessSelect.value = 'all';
        sortSelect.value = 'importance';
        searchInput.value = '';
        renderTags();
        applySortAndFilter(true);
      });

      renderCategoryButtons();
      renderTags();
      applySortAndFilter(true);

      if (window.matchMedia) {
        const darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addEventListener('change', (event) => {
          if (!localStorage.getItem(storageKey)) {
            applyTheme(event.matches ? 'dark' : 'light');
          }
        });
      }
    });
  </script>
</body>
</html>
