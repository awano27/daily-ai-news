<!DOCTYPE html>
<html lang="ja" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Daily AI News — %%UPDATED_FULL%%</title>
  <meta name="description" content="Daily AI News は AI 動向を俯瞰できる日本語ダイジェストです。">

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 15px;
    }
    .navbar-brand {
      font-weight: 700;
      font-size: 1.5rem;
    }
    .news-card {
      transition: transform 0.2s, box-shadow 0.2s;
      height: 100%;
    }
    .news-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .badge-importance-high { background-color: #dc3545; }
    .badge-importance-medium { background-color: #ffc107; color: #000; }
    .badge-importance-low { background-color: #6c757d; }
    .category-badge { font-size: 0.75rem; }
    [data-bs-theme="dark"] .news-card {
      background-color: #212529;
      border-color: #495057;
    }
    [data-bs-theme="dark"] .news-card:hover {
      box-shadow: 0 4px 12px rgba(255,255,255,0.1);
    }
    .nav-tabs .nav-link {
      cursor: pointer;
    }
    .search-tags .badge {
      cursor: pointer;
    }

    /* Support for legacy card styles from build.py */
    .news-card__header {
      padding: 1rem 1rem 0.5rem;
    }
    .news-card__title {
      font-size: 1.1rem;
      font-weight: 600;
      text-decoration: none;
      color: inherit;
    }
    .news-card__title:hover {
      color: #0d6efd;
    }
    .news-card__meta-top {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }
    .news-card__badge {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .news-card__badge--high {
      background-color: #dc3545;
      color: white;
    }
    .news-card__badge--medium {
      background-color: #ffc107;
      color: #000;
    }
    .news-card__badge--low {
      background-color: #6c757d;
      color: white;
    }
    .news-card__freshness,
    .news-card__score {
      font-size: 0.875rem;
      color: #6c757d;
    }
    .news-card__body {
      padding: 0.5rem 1rem;
    }
    .news-card__summary {
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 0.75rem;
    }
    .news-card__taglist {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      margin-bottom: 0.5rem;
    }
    .news-card__tag {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      background-color: #e9ecef;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      text-decoration: none;
      color: #495057;
    }
    .news-card__footer {
      padding: 0.5rem 1rem 1rem;
      border-top: 1px solid #dee2e6;
      font-size: 0.875rem;
    }
    .news-card__details {
      display: flex;
      gap: 1rem;
      margin: 0;
    }
    .news-card__details > div {
      display: flex;
      gap: 0.25rem;
    }
    .news-card__details dt {
      font-weight: 600;
      color: #6c757d;
    }
    .news-card__details dd {
      margin: 0;
    }
    .news-card__rank {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background-color: #0d6efd;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 700;
    }
    .news-card {
      position: relative;
      border: 1px solid #dee2e6;
      border-radius: 0.5rem;
      background-color: white;
    }
    [data-bs-theme="dark"] .news-card {
      background-color: #212529;
      border-color: #495057;
    }
    [data-bs-theme="dark"] .news-card__tag {
      background-color: #495057;
      color: #dee2e6;
    }
    [data-bs-theme="dark"] .news-card__footer {
      border-top-color: #495057;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <i class="bi bi-newspaper"></i> Daily AI News
      </a>
      <div class="d-flex align-items-center">
        <span class="text-white me-3 small">
          <i class="bi bi-clock"></i> %%UPDATED_FULL%%
        </span>
        <button class="btn btn-outline-light btn-sm" id="themeToggle" type="button">
          <i class="bi bi-moon-stars"></i>
        </button>
      </div>
    </div>
  </nav>

  <div class="container-fluid py-4">
    <!-- Stats -->
    <div class="row g-3 mb-4">
      <div class="col-md-3 col-sm-6">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title mb-0">%%TOTAL_ITEMS%%</h5>
            <p class="card-text text-muted small">総記事数</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title mb-0">%%BUSINESS_COUNT%%</h5>
            <p class="card-text text-muted small">ビジネス</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title mb-0">%%TOOLS_COUNT%%</h5>
            <p class="card-text text-muted small">ツール</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title mb-0">%%POSTS_COUNT%%</h5>
            <p class="card-text text-muted small">SNS/論文</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filters -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input type="text" class="form-control" id="searchInput" placeholder="キーワードで検索...">
            </div>
            <div id="searchTags" class="mt-2 search-tags"></div>
          </div>
          <div class="col-md-2">
            <select class="form-select" id="importanceFilter">
              <option value="all">すべての重要度</option>
              <option value="high">高 (7.0+)</option>
              <option value="medium">中 (4.0-6.9)</option>
              <option value="low">低 (0-3.9)</option>
            </select>
          </div>
          <div class="col-md-2">
            <select class="form-select" id="freshnessFilter">
              <option value="all">すべての期間</option>
              <option value="24h">24時間以内</option>
              <option value="3d">3日以内</option>
              <option value="7d">7日以内</option>
            </select>
          </div>
          <div class="col-md-2">
            <button class="btn btn-outline-secondary w-100" id="clearFilters">
              <i class="bi bi-x-circle"></i> クリア
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="categoryTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all"
                type="button" role="tab" data-category="all">
          <i class="bi bi-grid"></i> すべて
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="business-tab" data-bs-toggle="tab" data-bs-target="#business"
                type="button" role="tab" data-category="business">
          <i class="bi bi-briefcase"></i> ビジネス
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="tools-tab" data-bs-toggle="tab" data-bs-target="#tools"
                type="button" role="tab" data-category="tools">
          <i class="bi bi-tools"></i> ツール
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="posts-tab" data-bs-toggle="tab" data-bs-target="#posts"
                type="button" role="tab" data-category="posts">
          <i class="bi bi-chat-dots"></i> SNS/論文
        </button>
      </li>
    </ul>

    <!-- Results Count -->
    <div class="alert alert-info" role="status" id="resultsCount">
      %%TOTAL_ITEMS%% 件の記事を表示中
    </div>

    <!-- News Grid -->
    <div class="tab-content" id="categoryTabContent">
      <div class="tab-pane fade show active" id="all" role="tabpanel">
        <div class="row g-4" id="newsGrid">
          %%LEGACY_SECTIONS%%
        </div>
      </div>
      <div class="tab-pane fade" id="business" role="tabpanel">
        <div class="row g-4" id="businessGrid"></div>
      </div>
      <div class="tab-pane fade" id="tools" role="tabpanel">
        <div class="row g-4" id="toolsGrid"></div>
      </div>
      <div class="tab-pane fade" id="posts" role="tabpanel">
        <div class="row g-4" id="postsGrid"></div>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5.3 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('searchInput');
      const searchTags = document.getElementById('searchTags');
      const importanceFilter = document.getElementById('importanceFilter');
      const freshnessFilter = document.getElementById('freshnessFilter');
      const clearFilters = document.getElementById('clearFilters');
      const resultsCount = document.getElementById('resultsCount');
      const themeToggle = document.getElementById('themeToggle');
      const html = document.documentElement;

      // Wrap news cards in Bootstrap grid columns
      const newsGrid = document.getElementById('newsGrid');
      const cards = newsGrid.querySelectorAll('.news-card');
      cards.forEach(card => {
        const col = document.createElement('div');
        col.className = 'col-md-6 col-lg-4';
        card.parentNode.insertBefore(col, card);
        col.appendChild(card);
      });

      // Populate category tabs with cards
      function populateCategoryTabs() {
        const businessGrid = document.getElementById('businessGrid');
        const toolsGrid = document.getElementById('toolsGrid');
        const postsGrid = document.getElementById('postsGrid');

        // Clear existing content
        businessGrid.innerHTML = '';
        toolsGrid.innerHTML = '';
        postsGrid.innerHTML = '';

        // Get all cards and clone them to category tabs
        const allCards = newsGrid.querySelectorAll('.col-md-6');

        allCards.forEach(colDiv => {
          const card = colDiv.querySelector('.news-card');
          if (!card) return;

          const category = card.dataset.categorySlug;

          // Clone card with its wrapper
          const clonedCol = colDiv.cloneNode(true);

          // Add to appropriate category grid
          if (category === 'business') {
            businessGrid.appendChild(clonedCol);
          } else if (category === 'tools') {
            toolsGrid.appendChild(clonedCol);
          } else if (category === 'posts') {
            postsGrid.appendChild(clonedCol);
          }
        });
      }

      // Populate tabs on load
      populateCategoryTabs();

      // Update visible count when tab changes
      const tabButtons = document.querySelectorAll('#categoryTabs button[data-bs-toggle="tab"]');
      tabButtons.forEach(button => {
        button.addEventListener('shown.bs.tab', (event) => {
          applyFilters();
        });
      });

      // Theme toggle
      themeToggle.addEventListener('click', () => {
        const currentTheme = html.getAttribute('data-bs-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-bs-theme', newTheme);
        const icon = themeToggle.querySelector('i');
        icon.className = newTheme === 'dark' ? 'bi bi-sun' : 'bi bi-moon-stars';
        localStorage.setItem('theme', newTheme);
      });

      // Load saved theme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        html.setAttribute('data-bs-theme', savedTheme);
        const icon = themeToggle.querySelector('i');
        icon.className = savedTheme === 'dark' ? 'bi bi-sun' : 'bi bi-moon-stars';
      }

      // Search functionality
      let keywords = [];

      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          const value = searchInput.value.trim();
          if (value && !keywords.includes(value)) {
            keywords.push(value);
            renderSearchTags();
            searchInput.value = '';
            applyFilters();
          }
        }
      });

      function renderSearchTags() {
        searchTags.innerHTML = keywords.map(keyword =>
          `<span class="badge bg-primary me-2 mb-2" data-keyword="${keyword}">
            ${keyword} <i class="bi bi-x" style="cursor:pointer"></i>
          </span>`
        ).join('');

        searchTags.querySelectorAll('.badge').forEach(badge => {
          badge.addEventListener('click', (e) => {
            const keyword = badge.dataset.keyword;
            keywords = keywords.filter(k => k !== keyword);
            renderSearchTags();
            applyFilters();
          });
        });
      }

      function applyFilters() {
        // Get active tab
        const activeTab = document.querySelector('#categoryTabs .nav-link.active');
        const activeTabId = activeTab ? activeTab.getAttribute('data-bs-target').replace('#', '') : 'all';

        // Get cards in the active tab
        let targetGrid;
        if (activeTabId === 'all') {
          targetGrid = document.getElementById('newsGrid');
        } else if (activeTabId === 'business') {
          targetGrid = document.getElementById('businessGrid');
        } else if (activeTabId === 'tools') {
          targetGrid = document.getElementById('toolsGrid');
        } else if (activeTabId === 'posts') {
          targetGrid = document.getElementById('postsGrid');
        }

        if (!targetGrid) return;

        const cards = targetGrid.querySelectorAll('.news-card');
        const importance = importanceFilter.value;
        const freshness = freshnessFilter.value;
        let visibleCount = 0;

        cards.forEach(card => {
          let visible = true;

          // Importance filter
          if (importance !== 'all') {
            const cardImportance = card.dataset.importance;
            if (cardImportance !== importance) visible = false;
          }

          // Freshness filter
          if (freshness !== 'all' && visible) {
            const cardFreshness = card.dataset.freshnessBucket;
            if (freshness === '24h' && cardFreshness !== '24h') visible = false;
            if (freshness === '3d' && !['24h', '72h'].includes(cardFreshness)) visible = false;
            if (freshness === '7d' && !['24h', '72h', '168h'].includes(cardFreshness)) visible = false;
          }

          // Keyword filter
          if (keywords.length > 0 && visible) {
            const text = card.textContent.toLowerCase();
            const hasAllKeywords = keywords.every(keyword =>
              text.includes(keyword.toLowerCase())
            );
            if (!hasAllKeywords) visible = false;
          }

          const colDiv = card.closest('.col-md-6');
          if (colDiv) {
            colDiv.style.display = visible ? '' : 'none';
            if (visible) visibleCount++;
          }
        });

        resultsCount.textContent = `${visibleCount} 件の記事を表示中`;
      }

      importanceFilter.addEventListener('change', applyFilters);
      freshnessFilter.addEventListener('change', applyFilters);

      clearFilters.addEventListener('click', () => {
        searchInput.value = '';
        keywords = [];
        renderSearchTags();
        importanceFilter.value = 'all';
        freshnessFilter.value = 'all';
        applyFilters();
      });

      // Initial filter application
      applyFilters();
    });
  </script>
</body>
</html>
